---
title: 订单设计
tags: 架构设计
categories: 架构设计
img: /gallery/thumbnails/order_checkout.png
---
{% img /gallery/thumbnails/order_checkout.png order_checkout %}
## 账单/订单定义
在阅读[账单/订单的区别](https://www.jianshu.com/p/bf0c82053167)之后，我理解为账单仅此是管帐是以money为中心，记录账务往来。主要有三种来源：
- 服务（虚，服务）
- 产品（实，购买）
- 资源（实，租赁）

上面的是`虚`只是服务可能是虚拟的也可以上门的家政服务或者是理发之类的，不存在实际的交易物品，而`实`存在实际的交易物品的。

账单是商品为中心的，主要管理Order2Payment的过程，包含了配送的过程，所以我理解下单到支付、配送，支付和配送可能存在也可能不存在。具体情况可以举例子：
- 支付不存在配送存在（赠送产品或非虚拟服务）
- 支付存在配送不存在 （虚拟物品，比如游戏道具）
- 支付存在配送存在 （实际交易物品）
- 支付不存在配送不存在 （赠送虚拟物品）
 
有两个例子比较特殊，但其实也是存在的。在账单阶段获取购物项、设置公共配送地址（每个账单可以单独修改），然后在一定时间内（商品价格或者优惠等变化影响到支付金额）生成草稿订单。在生成草稿订单时计算预计服务时间、预计配送到达时间等，草稿订单跟账单一样短时间未支付失效，原因有以下几点：
- 价格和优惠规则变化影响支付结果
- 库存，正常的电商应该是先减库存
- 支付平台预订单未支付超时限制
 
## 账单/订单时序图
[账单/订单的创建](https://community.shopify.com/c/Shopify-APIs-SDKs/Difference-between-Webhook-quot-checkout-create-quot-quot-orders/m-p/484682#M31120)

